%!TEX root = ../Thesis.tex
\section{Anhang - Quelltexte}
\fancyhead[R]{Anhang - Quelltexte}
\label{instal}

\subsection{Activities}
	\subsubsection{Overview}
		\paragraph{Event Fragment}
\lstinputlisting [caption=OverviewEventController (Yannick Rüttgers)]{code/OverviewEventController.java}
\lstinputlisting [caption=OverviewEventData (Yannick Rüttgers)]{code/OverviewEventData.java}
\lstinputlisting [caption=OverviewEventGui (Yannick Rüttgers)]{code/OverviewEventGui.java}
\lstinputlisting [caption=OverviewEventInit (Yannick Rüttgers)]{code/OverviewEventInit.java}
		\paragraph{Header}
\lstinputlisting [caption=OverviewHeaderClickListener (Fabia Schmid)]{code/OverviewHeaderClickListener.java}
\lstinputlisting [caption=OverviewHeaderCreateFragment (Yannick Rüttgers)]{code/OverviewHeaderCreateFragment.java}
\lstinputlisting [caption=OverviewHeaderDeleteFragment (Yannick Rüttgers)]{code/OverviewHeaderDeleteFragment.java}
\lstinputlisting [caption=OverviewHeaderSearchFragment (Yannick Rüttgers)]{code/OverviewHeaderSearchFragment.java}
		\paragraph{Image Fragment}
\lstinputlisting [caption=OverviewImageController (Yannick Rüttgers)]{code/OverviewImageController.java}
\lstinputlisting [caption=OverviewImageData (Yannick Rüttgers)]{code/OverviewImageData.java}
\lstinputlisting [caption=OverviewImageGui (Yannick Rüttgers)]{code/OverviewImageGui.java}
\lstinputlisting [caption=OverviewImageInit (Yannick Rüttgers)]{code/OverviewImageInit.java}
		\paragraph{Note Fragment}
\lstinputlisting [caption=OverviewNoteController (Yannick Rüttgers)]{code/OverviewNoteController.java}
\lstinputlisting [caption=OverviewNoteData (Yannick Rüttgers)]{code/OverviewNoteData.java}
\lstinputlisting [caption=OverviewNoteGui (Yannick Rüttgers)]{code/OverviewNoteGui.java}
\lstinputlisting [caption=OverviewNoteInit (Yannick Rüttgers)]{code/OverviewNoteInit.java}
		\paragraph{Overview Activity}
\lstinputlisting [caption=OverviewFragmentFactory (Yannick Rüttgers)]{code/OverviewFragmentFactory.java}
\lstinputlisting [caption=OverviewFragmentInserter (Yannick Rüttgers)]{code/OverviewFragmentInserter.java}
\lstinputlisting [caption=OverviewClickListener (Yannick Rüttgers)]{code/OverviewClickListener.java}
\lstinputlisting [caption=OverviewController (Yannick Rüttgers)]{code/OverviewController.java}
\lstinputlisting [caption=OverviewData (Yannick Rüttgers)]{code/OverviewData.java}
\lstinputlisting [caption=OverviewDeleteHandler (Yannick Rüttgers)]{code/OverviewDeleteHandler.java}
\lstinputlisting [caption=OverviewGui (Yannick Rüttgers)]{code/OverviewGui.java}
\lstinputlisting [caption=OverviewInit (Yannick Rüttgers)]{code/OverviewInit.java}
\lstinputlisting [caption=OverviewNewClickHandler (Yannick Rüttgers)]{code/OverviewNewClickHandler.java}
		\paragraph{Super Classes}
\lstinputlisting [caption=OverviewFragmentClickListener (Fabia Schmid)]{code/OverviewFragmentClickListener.java}
\lstinputlisting [caption=OverviewFragmentController (Yannick Rüttgers)]{code/OverviewFragmentController.java}
\lstinputlisting [caption=OverviewFragmentData (Yannick Rüttgers)]{code/OverviewFragmentData.java}
\lstinputlisting [caption=OverviewFragmentGui (Yannick Rüttgers)]{code/OverviewFragmentGui.java}
\lstinputlisting [caption=OverviewFragmentInit (Yannick Rüttgers)]{code/OverviewFragmentInit.java}
\lstinputlisting [caption=OverviewFragmentLongClickListener (Fabia Schmid)]{code/OverviewFragmentLongClickListener.java}
		\paragraph{Todo Fragments}
\lstinputlisting [caption=OverviewTodoController (Yannick Rüttgers)]{code/OverviewTodoController.java}
\lstinputlisting [caption=OverviewTodoData (Yannick Rüttgers)]{code/OverviewTodoData.java}
\lstinputlisting [caption=OverviewTodoGui (Yannick Rüttgers)]{code/OverviewTodoGui.java}
\lstinputlisting [caption=OverviewTodoInit (Yannick Rüttgers)]{code/OverviewTodoInit.java}
	\subsubsection{Event}
\lstinputlisting [caption=EventActivity (Robin Menzel)]{code/EventActivity.java}
		\paragraph{Data}
\lstinputlisting [caption=EventData (Robin Menzel)]{code/EventData.java}
\lstinputlisting [caption=Reminder (Robin Menzel)]{code/Reminder.java}
		\paragraph{GUI}
\lstinputlisting [caption=DatePickerFragment (Robin Menzel)]{code/evDatePickerFragment.java}
\lstinputlisting [caption=EventGui (Robin Menzel)]{code/EventGui.java}
\lstinputlisting [caption=RecurringTypeHelper (Robin Menzel)]{code/RecurringTypeHelper.java}
\lstinputlisting [caption=TimePickerFragment (Robin Menzel)]{code/TimePickerFragment.java}
		\paragraph{Logic}
\lstinputlisting [caption=EventApplicationLogic (Robin Menzel)]{code/EventApplicationLogic.java}
\lstinputlisting [caption=EventClickListener (Robin Menzel)]{code/EventClickListener.java}
\lstinputlisting [caption=EventMenuItemClickListener (Robin Menzel)]{code/EventMenuItemClickListener.java}
\lstinputlisting [caption=TextWatcher (Robin Menzel)]{code/evTextWatcher.java}
		\paragraph{Reminder}
\lstinputlisting [caption=AlarmManagerHelper (Robin Menzel)]{code/AlarmManagerHelper.java}
\lstinputlisting [caption=AlertReceiver (Robin Menzel)]{code/AlertReceiver.java}
\lstinputlisting [caption=NotificationHelper (Robin Menzel)]{code/NotificationHelper.java}
	\subsubsection{Note}
		\paragraph{Note}
\lstinputlisting [caption=NoteActivity (Joscha Nassenstein)]{code/NoteActivity.java}
			\subparagraph{Data}
\lstinputlisting [caption=NoteConstants (Jan Beilfuß)]{code/NoteConstants.java}
\lstinputlisting [caption=NoteData (Joscha Nassenstein)]{code/NoteData.java}
\lstinputlisting [caption=NoteDataHelper (Jan Beilfuß)]{code/NoteDataHelper.java}
%Backend Oriented
\lstinputlisting [caption=NoteLoader (Jan Beilfuß)]{code/NoteLoader.java}
\lstinputlisting [caption=NotePreviewImageLoader (Jan Beilfuß)]{code/NotePreviewImageLoader.java}
\lstinputlisting [caption=PriorityOriginalImageLoader (Jan Beilfuß)]{code/PriorityOriginalImageLoader.java}
\lstinputlisting [caption=TaskManager (Jan Beilfuß)]{code/TaskManager.java}
\lstinputlisting [caption=NoteDataBackend (Jan Beilfuß)]{code/NoteDataBackend.java}
%Gui Oriented
\lstinputlisting [caption=NoteDataGui (Jan Beilfuß)]{code/NoteDataGui.java}
\lstinputlisting [caption=PreviewImageCreator (Joscha Nassenstein)]{code/PreviewImageCreator.java}
			\subparagraph{Gui}
\lstinputlisting [caption=GraphicsContainer (Joscha Nassenstein)]{code/GraphicsContainer.java}
\lstinputlisting [caption=IconContainer (Joscha Nassenstein)]{code/IconContainer.java}
\lstinputlisting [caption=ImageContainer (Joscha Nassenstein)]{code/ImageContainer.java}
\lstinputlisting [caption=ImageOverlay (Joscha Nassenstein)]{code/ImageOverlay.java}
\lstinputlisting [caption=NoteGui (Joscha Nassenstein)]{code/NoteGui.java}
			\subparagraph{Logic}
\lstinputlisting [caption=NoteApplicationLogic (Joscha Nassenstein)]{code/NoteApplicationLogic.java}
\lstinputlisting [caption=NoteAsyncLoadingLogic (Jan Beilfuß)]{code/NoteAsyncLoadingLogic.java}
\lstinputlisting [caption=NoteGalleryImportLogic (Jan Beilfuß)]{code/NoteGalleryImportLogic.java}
\lstinputlisting [caption=NoteGuiRefresherLogic (Joscha Nassenstein)]{code/NoteGuiRefresherLogic.java}
\lstinputlisting [caption=NoteImageImportLogic (Joscha Nassenstein)]{code/NoteImageImportLogic.java}
\lstinputlisting [caption=NoteImagePopupLogic (Joscha Nassenstein)]{code/NoteImagePopupLogic.java}
\lstinputlisting [caption=NoteNavigationLogic (Joscha Nassenstein)]{code/NoteNavigationLogic.java}
%Listener Watcher
\lstinputlisting [caption=DialogClickListener (Joscha Nassenstein)]{code/DialogClickListener.java}
\lstinputlisting [caption=EventDispersion (Joscha Nassenstein)]{code/EventDispersion.java}
\lstinputlisting [caption=ImageOverlayListener (Jan Beilfuß)]{code/ImageOverlayListener.java}
\lstinputlisting [caption=ClickListener (Joscha Nassenstein)]{code/loClickListener.java}
\lstinputlisting [caption=MenuItemClickListener (Joscha Nassenstein)]{code/loMenuItemClickListener.java}
\lstinputlisting [caption=MotionListener (Joscha Nassenstein)]{code/MotionListener.java}
\lstinputlisting [caption=NoteListenerHandler (Joscha Nassenstein)]{code/NoteListenerHandler.java}
\lstinputlisting [caption=NoteListenerInitializer (Joscha Nassenstein)]{code/NoteListenerInitializer.java}
\lstinputlisting [caption=NoteTextWatcher (Joscha Nassenstein)]{code/NoteTextWatcher.java}
		\paragraph{Notetags}
\lstinputlisting [caption=ApplicationLogic (Joscha Nassenstein)]{code/ApplicationLogic.java}
\lstinputlisting [caption=ListViewAdapter (Joscha Nassenstein)]{code/ListViewAdapter.java}
\lstinputlisting [caption=NoteTagActivity (Joscha Nassenstein)]{code/NoteTagActivity.java}
\lstinputlisting [caption=ClickListener (Joscha Nassenstein)]{code/ntClickListener.java}
\lstinputlisting [caption=Gui (Joscha Nassenstein)]{code/ntGui.java}
\lstinputlisting [caption=MenuItemClickListener (Joscha Nassenstein)]{code/ntMenuItemClickListener.java}
\lstinputlisting [caption=TextWatcher (Joscha Nassenstein)]{code/ntTextWatcher.java}
	\subsubsection{Todo}
\lstinputlisting [caption=CheckedChangeListener (Sertan Cetin)]{code/CheckedChangeListener.java}
\lstinputlisting [caption=ClickListener (Sertan Cetin)]{code/ClickListener.java}
\lstinputlisting [caption=Data (Sertan Cetin)]{code/Data.java}
\lstinputlisting [caption=DateChecker (Florian Rath)]{code/DateChecker.java}
\lstinputlisting [caption=DatePickerFragment (Florian Rath)]{code/DatePickerFragment.java}
\lstinputlisting [caption=Gui (Florian Rath)]{code/Gui.java}
\lstinputlisting [caption=Init (Sertan Cetin)]{code/Init.java}
\lstinputlisting [caption=MenuItemClickListener (Florian Rath)]{code/MenuItemClickListener.java}
\lstinputlisting [caption=TasksAdapter (Sertan Cetin)]{code/TasksAdapter.java}
\lstinputlisting [caption=TextWatcher (Florian Rath)]{code/TextWatcher.java}
\lstinputlisting [caption=TodoApplicationLogic (Florian Rath)]{code/TodoApplicationLogic.java}
\lstinputlisting [caption=TouchListener (Sertan Cetin)]{code/TouchListener.java}
\subsection{Data}
	\subsubsection{Models}
		\paragraph{TENs}
\lstinputlisting [caption=TEN (Joscha Nassenstein)]{code/TEN.java}
\lstinputlisting [caption=Todo (Joscha Nassenstein)]{code/Todo.java}
\lstinputlisting [caption=Event (Joscha Nassenstein)]{code/Event.java}
\lstinputlisting [caption=Note (Joscha Nassenstein)]{code/Note.java}
		\paragraph{Utils}
\begin{figure}[H]
\begin{lstlisting}[caption=BundleKeys (Jan Beilfuß)]
public class BundleKeys {
    //TEN Keys
    public static final String KEY_TEN_ID = "TenID";
    public static final String KEY_TEN_TITLE = "TenTitle";
    public static final String KEY_TEN_COLOR = "TenColor";
    public static final String KEY_TEN_ACCENT_COLOR = "TenAccentColor";
    public static final String KEY_TEN_DATE_OF_CREATION = "TenDateOfCreation";
    //Event Keys
    public static final String KEY_EVENT_TIME = "EventTime";
    public static final String KEY_EVENT_ADDRESS = "EventAdress";
    //Note Keys
    public static final String KEY_NOTE_DESCRIPTION = "NoteDescription";
    public static final String KEY_NOTE_TAGS = "NoteTags";
    public static final String KEY_NOTE_PICTURES = "NotePictures";
    //To Do Keys
    public static final String KEY_TODO_NOTE = "TodoNote";
    public static final String KEY_TODO_STATUS = "TodoStatus";
    public static final String KEY_TODO_DESCRIPTION = "TodoDescription";
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=Colors (Jan Beilfuß)]
public class Colors {
    //700er Material Colors
    public static final int[] COLORS = {
            0xFF0288D1, //light blue
            0xFFEF5350, //red
            0xFFAFB42B, //lime
            0xFF388E3C, //green
            0xFFFB8C00, //Orange
            0xFF7E57C2, //Deep Purple
            0xFFEC407A, //Pink
            0xFF009688, //Teal
    };
    //900er Material Colors
    public static final int[] DARKER_ACCENT_COLORS = {
            0xFF01579B, //light blue
            0xFFB71C1C, //red
            0xFF827717, //lime
            0xFF1B5E20, //green
            0xFFEF6C00, //orange
            0xFF512DA8, //Deep Purple
            0xFFC2185B, //Pink
            0xFF00796B, //Teal
    };
    public static int getRandomColorIndex() {
        int index = Colors.COLORS.length;
        while (index == Colors.COLORS.length) {
            index = (int) (Math.random() * Colors.COLORS.length);
        }
        return index;
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=Image (Jan Beilfuß)]
public class Image {
    private String id;
    @JsonIgnore
    private Bitmap bitmap;
    //Constructor
    public Image() {
        this.id = "";
        this.bitmap = null;
    }
    public Image(String id) {
        this.id = id;
        this.bitmap = null;
    }
    public Image(String id, Bitmap bitmap) {
        this.id = id;
        this.bitmap = bitmap;
    }
    public Image (Image image){
        this.id = "" + image.getId();
        if(image.getBitmap()!=null){
            this.bitmap = Bitmap.createBitmap(image.getBitmap());
        }
    }
    //Getter and Setter
    public String getId() {
        return id;
    }
    public void setId(String id) {
        this.id = id;
    }
    public Bitmap getBitmap() {
        return bitmap;
    }
    public void setBitmap(Bitmap bitmap) {
        this.bitmap = bitmap;
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=MockData (Jan Beilfuß)]

\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=ReccuringType (Joscha Nassenstein)]
public enum RecurringType {
    NONE,DAILY,WEEKLY,MONTHLY,YEARLY
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=Tasks (Joscha Nassenstein)]
public class Task {
    private String description;
    private boolean status;
    //Constructors
    public Task(){
        this.description = "";
        this.status = false;
    }
    public Task(String description){
        this.description = description;
        this.status = false;
    }
    public Task(String description, boolean status){
        this.description = description;
        this.status = status;
    }
    //Getters and Setters
    public String getDescription(){return description;}
    public void setDescription(String description) {this.description = description;}

    public boolean getStatus(){return status;}
    public void setStatus(boolean status){this.status = status;}
}
\end{lstlisting}
\end{figure}
	\subsubsection{Repository}
\begin{figure}[H]
\begin{lstlisting}[caption=DatabaseRepository (Jan Beilfuß)]
/Class that manages All Requests to the Database
//Author: Jan Beilfuss
public class DatabaseRepository {
    ReadRepository mReadRepository;
    WriteRepository mWriteRepository;
    public DatabaseRepository() {
        this.mReadRepository = new ReadRepository();
        this.mWriteRepository = new WriteRepository();
    }
    public Todo getTodoByID(String pId) {
        return mReadRepository.getTodoByID(pId);
    }
    public Event getEventByID(String pId) {
        return mReadRepository.getEventByID(pId);
    }
    public Note getNoteByID(String pId) {
        return mReadRepository.getNoteByID(pId);
    }
    //for new TEN-Objects
    public void insertTEN(TEN pTen) { mWriteRepository.insertTEN(pTen); }
    //for already saved TEN-Objects
    public void updateTEN(TEN pTen) {
        mWriteRepository.updateTEN(pTen);
    }
    public ArrayList<TEN> getAllTENs() {
        return mReadRepository.getAllTENs();
    }
    public boolean deleteTEN(String pTenId) {
        return mWriteRepository.deleteTEN(pTenId);
    }
    //returns main and accent color for given TEN-Object-ID
    public int[] getTENColors(String pTenId) {
        return mReadRepository.getTENColors(pTenId);
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=DataContextManager (Jan Beilfuß)]
//Class that provides the database to the DatabaseRepository-Classes and Functions
//Author: Jan Beilfuss
public class DataContextManager {
    public static Database database = null;
    public static Context context = null;
    //Gets Database from Context if it is not set
    public static void initDatabase(Context pContext) {
        if (DataContextManager.getDatabase() == null) {
            DataContextManager.context = null;
            DataContextManager.context = pContext;
            try {
                DatabaseConfiguration config = new DatabaseConfiguration(pContext.getApplicationContext());
                DataContextManager.database = new Database(RepositoryConstants.DATABASENAME, config);
                compactDatabase();
            } catch (CouchbaseLiteException e) {
                Toast.makeText(pContext, "Fehler bei der Datenbankerstellung", Toast.LENGTH_LONG);
            }
        }
    }
    //Compacts the Database = Cleans all Empty Entries (they are just flagged on Delete)
    public static void compactDatabase() {
        try {
            DataContextManager.getDatabase().compact();
        } catch (CouchbaseLiteException e) {
        }
    }
    //returns the number of Documents in the Database. ONLY needed when using Mockdata
    public static int getNumberOfDocuments() {
        Query query = QueryBuilder.select(SelectResult.expression(Meta.id)).from(DataSource.database(DataContextManager.getDatabase()));
        try {
            ResultSet rs = query.execute();
            return rs.allResults().size();
        } catch (CouchbaseLiteException e) {
            return -1;
        }
    }
    public static Database getDatabase() {
        return DataContextManager.database;
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=RepositoryConstants (Jan Beilfuß)]
//Author: Jan Beilfuss
public class RepositoryConstants {
    //database name
    public static final String DATABASENAME = "TENDB";
    //Keys for Key-Value-Pairs in Document
    public static final String OBJECT_KEY = "ObjectKey";
    public static final String TYPE_KEY = "TypeKey";
    public static final String CREATION_DATE_KEY = "CreationDateKey";
    public static final String COLOR_KEY = "ColorKey";
    public static final String ACCENT_COLOR_KEY = "AccentColorKey";
    public static final String COUCHBASE_ID_KEY = "id";
    //Type corresponding to TEN-Classes
    public static final String EVENT_TYPE = "Event";
    public static final String NOTE_TYPE = "Note";
    public static final String TODO_TYPE = "Todo";
}
\end{lstlisting}
\end{figure}
		\paragraph{Converter}
\begin{figure}[H]
\begin{lstlisting}[caption=QuerriedTenConverter (Jan Beilfuß)]
//class that manages the Conversion from Query Result to TEN Java Object
//Author: Jan Beilfuss
public class QueriedTenConverter {

    private TenJsonParser mTenJsonParser;
    private SeparateAttributesConverter mSeparateAttributesConverter;

    public QueriedTenConverter() {
        this.mTenJsonParser = new TenJsonParser();
        this.mSeparateAttributesConverter = new SeparateAttributesConverter();
    }

    //Method that maps the Dictionary of a Query Result To a TEN-Object
    //Object only contains Information from the JSON, but non of the ones stored in the document
    public TEN createTENFromResult(Result pResult) {

        Dictionary dictionary = pResult.getDictionary(RepositoryConstants.DATABASENAME);
        String type = dictionary.getString(RepositoryConstants.TYPE_KEY);
        String objectJSON = dictionary.getString(RepositoryConstants.OBJECT_KEY);

        TEN resultTEN = null;
        switch (type) {
            case RepositoryConstants.EVENT_TYPE:
                resultTEN = mTenJsonParser.stringToEvent(objectJSON);
                break;
            case RepositoryConstants.NOTE_TYPE:
            resultTEN = mTenJsonParser.stringToNote(objectJSON);
                break;
            case RepositoryConstants.TODO_TYPE:
            resultTEN = mTenJsonParser.stringToTodo(objectJSON);
                break;
            default:
        }
        if (resultTEN != null) {
            resultTEN = this.mSeparateAttributesConverter.addTENPropertiesFromResult(resultTEN, pResult);
        }
        return resultTEN;
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=SeparateAttributesConverter (Jan Beilfuß)]
//Methods that adds all Attributes not stored in the JSON
//Author: Jan Beilfuss
public class SeparateAttributesConverter {

    //Document is the Databasereturn when getting only a single TEN
    public TEN addTENPropertiesFromDocument(TEN pTen, Document pDocument) {
        pTen.setID(pDocument.getId());
        pTen.setColor(pDocument.getInt(RepositoryConstants.COLOR_KEY));
        pTen.setAccentColor(pDocument.getInt(RepositoryConstants.ACCENT_COLOR_KEY));
        pTen.setDateOfCreation(pDocument.getDate(RepositoryConstants.CREATION_DATE_KEY));
        return pTen;
    }

    //Result is the Databasereturn when querying a set of TENs
    public TEN addTENPropertiesFromResult(TEN pTen, Result pResult) {
        Dictionary dictionary = pResult.getDictionary(RepositoryConstants.DATABASENAME);
        pTen.setID(pResult.getString(RepositoryConstants.COUCHBASE_ID_KEY));
        pTen.setColor(dictionary.getInt(RepositoryConstants.COLOR_KEY));
        pTen.setAccentColor(dictionary.getInt(RepositoryConstants.ACCENT_COLOR_KEY));
        pTen.setDateOfCreation(dictionary.getDate(RepositoryConstants.CREATION_DATE_KEY));

        return pTen;
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=TensJsonParser (Jan Beilfuß)]
//Class, that parses the JSON into a TEN Object
//Author: Jan Beilfuss
public class TenJsonParser {

    private ObjectMapper mObjectMapper;

    public TenJsonParser() {
        this.mObjectMapper = new ObjectMapper();
    }

    //parses To-do
    public Todo stringToTodo(String pJson) {
        try {
            Todo todo = this.mObjectMapper.readValue(pJson, Todo.class);
            return todo;
        } catch (IOException e) {
            return null;
        }
    }

    //parses Event
    public Event stringToEvent(String pJson) {
        try {
            Event event = this.mObjectMapper.readValue(pJson, Event.class);
            return event;
        } catch (IOException e) {
            return null;
        }
    }

    //parses Note
    public Note stringToNote(String pJson) {
        try {
            Note note = this.mObjectMapper.readValue(pJson, Note.class);
            return note;
        } catch (IOException e) {
            return null;
        }
    }
}
\end{lstlisting}
\end{figure}
		\paragraph{Filesystem}
\begin{figure}[H]
\begin{lstlisting}[caption=ImageDeleter (Jan Beilfuß)]
public class ImageDeleter {

    FileRepository mFileRepository;

    //Class that creates async Task to delete Images from the Filesystem
    //Author: Jan Beilfuss
    public ImageDeleter(FileRepository pFileRepository) {
        this.mFileRepository = pFileRepository;
    }

    public void execute(Image image) {
        DeleteImageTask deleteImageTask = new DeleteImageTask();
        deleteImageTask.execute(image);
    }

    private class DeleteImageTask extends AsyncTask<Image, Integer, Void> {

        //Deletes Image in preview and original folder
        @Override
        protected Void doInBackground(Image... images) {
            String[] folders = {FileSystemConstants.IMAGE_ORIGINAL_FOLDER, FileSystemConstants.IMAGE_PREVIEW_FOLDER};

            for (String folder : folders) {
                String directoryPath = mFileRepository.getContext().getExternalFilesDir(Environment.DIRECTORY_PICTURES).getAbsolutePath() + "/" + folder + "/";
                String filePath = directoryPath + images[0].getId() + ".jpg";

                File file = new File(filePath);
                if (file.exists()) {
                    file.delete();
                }
            }
            return null;
        }
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=ImageSaver (Jan Beilfuß)]
public class ImageSaver {

    FileRepository mFileRepository;

    //Class that creates async Task to save Images to the filesystem
    //Author: Jan Beilfuss
    public ImageSaver(FileRepository pFileRepository) {
        this.mFileRepository = pFileRepository;
    }

    public void execute(Image image) throws IOException {
        Image copy = new Image(image);
        image.setBitmap(null);
        SaveImageTask saveImageTask = new SaveImageTask();
        saveImageTask.execute(copy);
    }

    private class SaveImageTask extends AsyncTask<Image, Integer, Void> {

        //saves Image to preview and original folder
        @Override
        protected Void doInBackground(Image... images) {
            PreviewImageCreator previewImageCreator = new PreviewImageCreator();
            Context context = DataContextManager.context;
            String[] folders = {FileSystemConstants.IMAGE_ORIGINAL_FOLDER, FileSystemConstants.IMAGE_PREVIEW_FOLDER};

            for (String folder : folders) {
                String folderPath = Environment.DIRECTORY_PICTURES + "/" + folder;
                String imageName = images[0].getId() + FileSystemConstants.JPEG;

                File storageDir = context.getExternalFilesDir(folderPath);
                FileOutputStream fos = null;
                Bitmap bitmap = images[0].getBitmap();
                File image = new File(storageDir, imageName);

                if (!image.exists()) {
                    if (bitmap != null) {
                        if (folder.equals(FileSystemConstants.IMAGE_PREVIEW_FOLDER)) {
                            bitmap = previewImageCreator.getPreviewImage(bitmap);
                        }
                        try {
                            fos = new FileOutputStream(image);
                        } catch (FileNotFoundException e) {
                        }

                        bitmap.compress(Bitmap.CompressFormat.JPEG, FileSystemConstants.COMPRESSION_FACTOR, fos);
                        try {
                            fos.flush();
                            fos.close();
                        } catch (IOException e) {
                        }
                    }
                }
            }
            images[0].setBitmap(null);
            return null;
        }
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=FileRepositroy (Jan Beilfuß)]
//Class that handles everything regarding persistent Images
//Author: Jan Beilfuss
public class FileRepository {
    public Context getContext() {
        return DataContextManager.context;
    }

    //creates ImageSaver to save Images to the Filesystem
    public void saveImagePersistent(Image pImage) throws IOException {
        ImageSaver imageSaver = new ImageSaver(this);
        imageSaver.execute(pImage);
    }

    //reads and decodes Image from the Filesystem
    public Image readImageFromDirectory(Image image, String directory) {
        Context context = DataContextManager.context;
        String directoryPath = context.getExternalFilesDir(Environment.DIRECTORY_PICTURES).getAbsolutePath() + "/" + directory + "/";
        String filePath = directoryPath + image.getId() + FileSystemConstants.JPEG;
        Bitmap bitmap = BitmapFactory.decodeFile(filePath);
        Image result = new Image(image.getId(), bitmap);
        return result;
    }

    //deletes single file at given path
    public void deleteImageFromDirectories(String path) {
        File file = new File(path);
        if(file.exists()) file.delete();
    }

    //creates ImageDeleter to delete Files from orignal and preview folder
    public void deleteImageFromDirectories(Image image) {
        ImageDeleter imageDeleter = new ImageDeleter(this);
        imageDeleter.execute(image);
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=FileSystemConstants (Jan Beilfuß)]
public class FileSystemConstants {
    public static final String JPEG = ".jpg";
    public static final int COMPRESSION_FACTOR = 75;

    public static final String IMAGE_CORE_ID = "imageID";

    public static final String IMAGE_ORIGINAL_FOLDER = "original";
    public static final String IMAGE_PREVIEW_FOLDER = "preview";
}
\end{lstlisting}
\end{figure}
		\paragraph{Sub-Repositories}
\begin{figure}[H]
\begin{lstlisting}[caption=GetAllTensQuery (Jan Beilfuß)]
//Class that contains our currently only Database-Query
//Author: Jan Beilfuss
public class GetAllTensQuery {

    private QueriedTenConverter mQueriedTenConverter;

    public GetAllTensQuery() { this.mQueriedTenConverter = new QueriedTenConverter(); }

    //Creates Query for all Saved TENs and returns converted java objects
    public ArrayList<TEN> getAllTENs() {
        Query query = QueryBuilder.select(
                SelectResult.all(),
                SelectResult.expression(Meta.id))
                .from(DataSource.database(DataContextManager.getDatabase()))
                .orderBy(Ordering.property(RepositoryConstants.CREATION_DATE_KEY).descending());
        ArrayList<TEN> resultList = new ArrayList<TEN>();

        try {
            ResultSet rs = query.execute();

            List<Result> allResults = rs.allResults();
            for (Result result : allResults) {
                TEN tenObject = this.mQueriedTenConverter.createTENFromResult(result);
                resultList.add(tenObject);
            }
            return resultList;

        } catch (CouchbaseLiteException e) {
            return null;
        }
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=ReadRepository (Jan Beilfuß)]
//Class, that manages all reading Requests onto the Database
//Author: Jan Beilfuss
public class ReadRepository {
    TenJsonParser mTenJsonParser;
    SeparateAttributesConverter mSeparateAttributesConverter;
    GetAllTensQuery mGetAllTensQuery;

    public ReadRepository (){
        this.mTenJsonParser = new TenJsonParser();
        this.mSeparateAttributesConverter = new SeparateAttributesConverter();
        this.mGetAllTensQuery = new GetAllTensQuery();
    }

    //returns To-Do with given ID
    public Todo getTodoByID(String pId) {
        Document todoDocument = DataContextManager.getDatabase().getDocument(pId);
        String json = todoDocument.getString(RepositoryConstants.OBJECT_KEY);
        Todo finalTodo = this.mTenJsonParser.stringToTodo(json);
        finalTodo = (Todo) this.mSeparateAttributesConverter.addTENPropertiesFromDocument(finalTodo, todoDocument);
        return finalTodo;
    }

    //returns Event with given ID
    public Event getEventByID(String pId) {
        Document eventDocument = DataContextManager.getDatabase().getDocument(pId);
        String json = eventDocument.getString(RepositoryConstants.OBJECT_KEY);
        Event finalEvent = this.mTenJsonParser.stringToEvent(json);
        finalEvent = (Event) this.mSeparateAttributesConverter.addTENPropertiesFromDocument(finalEvent, eventDocument);
        return finalEvent;
    }

    //returns Note with given ID
    public Note getNoteByID(String pId) {
        Document noteDocument = DataContextManager.getDatabase().getDocument(pId);
        String json = noteDocument.getString(RepositoryConstants.OBJECT_KEY);
        Note finalNote = this.mTenJsonParser.stringToNote(json);
        finalNote = (Note) this.mSeparateAttributesConverter.addTENPropertiesFromDocument(finalNote, noteDocument);
        return finalNote;
    }

    //returns all saved TEN-Objects
    public ArrayList<TEN> getAllTENs() {
        return mGetAllTensQuery.getAllTENs();
    }

    //Needed when TEN is loaded asynchronously for setting the Color of the Activity
    public int[] getTENColors(String pTenId) {
        Document document = DataContextManager.getDatabase().getDocument(pTenId);
        int[] colors = new int[2];
        colors[0] = document.getInt(RepositoryConstants.COLOR_KEY);
        colors[1] = document.getInt(RepositoryConstants.ACCENT_COLOR_KEY);
        return colors;
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=DocumentSaver (Jan Beilfuß)]
//class that manages the persistent saving process of Tens
//Author: Jan Beilfuss
public class DocumentSaver {

    ObjectMapper mObjectMapper;
    FileRepository mFileRepository;

    public DocumentSaver() {
        this.mObjectMapper = new ObjectMapper();
        this.mFileRepository = new FileRepository();
    }

    //manages process of writing a ten to a document and saving this
    public boolean updateCompleteDocument(TEN pTen, MutableDocument pMutableTENDocument) {
        pMutableTENDocument = setTypeOfDocument(pMutableTENDocument, pTen);
        pMutableTENDocument = saveSeparateAttributes(pMutableTENDocument, pTen);
        try {
            pMutableTENDocument.setString(RepositoryConstants.OBJECT_KEY, this.mObjectMapper.writeValueAsString(pTen));
            try {
                DataContextManager.getDatabase().save(pMutableTENDocument);
                return true;
            } catch (CouchbaseLiteException e) {
                return false;
            }
        } catch (JsonProcessingException e) {
            return false;
        }
    }

    //saves attributes not saved in the JSON-String
    private MutableDocument saveSeparateAttributes(MutableDocument pMutableDocument, TEN pTen){
        pMutableDocument.setDate(RepositoryConstants.CREATION_DATE_KEY, pTen.getDateOfCreation());
        pMutableDocument.setInt(RepositoryConstants.COLOR_KEY, pTen.getColor());
        pMutableDocument.setInt(RepositoryConstants.ACCENT_COLOR_KEY, pTen.getAccentColor());

        return pMutableDocument;
    }

    //Sets Type depending of the class of the given Object
    private MutableDocument setTypeOfDocument(MutableDocument pMutableDocument, TEN pTen) {

        if (pTen.getClass().getName().contains("Event")) {
            pMutableDocument.setString(RepositoryConstants.TYPE_KEY, RepositoryConstants.EVENT_TYPE);

        } else if (pTen.getClass().getName().contains("Note")) {
            pMutableDocument.setString(RepositoryConstants.TYPE_KEY, RepositoryConstants.NOTE_TYPE);

        } else if (pTen.getClass().getName().contains("Todo")) {
            pMutableDocument.setString(RepositoryConstants.TYPE_KEY, RepositoryConstants.TODO_TYPE);
        }
        return pMutableDocument;
    }
}

\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=WriteRepository (Jan Beilfuß)]
//Class that handles all writing accesses to the database
//Author: Jan Beilfuss
public class WriteRepository {

    private DocumentSaver mDocumentSaver;
    private TenJsonParser mTenJsonParser;
    private FileRepository mFileRepository;

    public WriteRepository(){
        this.mDocumentSaver = new DocumentSaver();
        this.mTenJsonParser = new TenJsonParser();
        this.mFileRepository = new FileRepository();
    }

    //new TEN to the Database
    public void insertTEN(TEN pTen) {
        MutableDocument mutableTENDocument = new MutableDocument();
        pTen.setID(mutableTENDocument.getId());
        this.mDocumentSaver.updateCompleteDocument(pTen, mutableTENDocument);
    }

    //already Existing TEN to the Database
    public void updateTEN(TEN pTen) {
        MutableDocument mutableTENDocument = DataContextManager.getDatabase().getDocument(pTen.getID()).toMutable();
        this.mDocumentSaver.updateCompleteDocument(pTen, mutableTENDocument);
    }

    public boolean deleteTEN(String pTenId) {
        Document document = DataContextManager.getDatabase().getDocument(pTenId);
        deleteNoteImages(document);
        try {
            if(document != null){
                DataContextManager.getDatabase().delete(document);
                return true;
            }
            return false;
        } catch (CouchbaseLiteException e) {
            return false;
        }
    }

    //Side Effects of Deleting a Note
    public void deleteNoteImages(Document pDocument) {
        if (pDocument.getString(RepositoryConstants.TYPE_KEY).equals(RepositoryConstants.NOTE_TYPE)) {
            String json = pDocument.getString(RepositoryConstants.OBJECT_KEY);
            Note note = mTenJsonParser.stringToNote(json);
            for(Image image: note.getPictures()){
                mFileRepository.deleteImageFromDirectories(image.getId());
            }
        }
    }
}
\end{lstlisting}
\end{figure}
	\subsubsection{Services}
\begin{figure}[H]
\begin{lstlisting}[caption=Create (Ruthild Gilles)]

public class Create {
    /* Ruthild Gilles
     Class Create contains methods to create new empty TEN objects.
     This class only exists to give a consistent form to the CRUD methods.
    */

    public static Todo newTodo() {
        return new Todo();
    }

    public static Event newEvent() {
        return new Event();
    }

    public static Note newNote() {
        return new Note();
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=Read (Ruthild Gilles)]

public class Read {
     /* Ruthild Gilles
     Class Read contains methods to get all or one specific TEN object.
    */

    /*--------------------------------------------------
        Method to get all TEN objects in an arraylist
     --------------------------------------------------*/
    public static ArrayList<TEN> getAllTENs() {
        DatabaseRepository databaseRepository = new DatabaseRepository();
        ArrayList<TEN> allTEN;
        allTEN = databaseRepository.getAllTENs();
        Log.i("Mainfix", "Number Of TENs: " + allTEN.size());
        for (TEN ten : allTEN) {
            Log.i("Mainfix", "ID: " + ten.getID() + ", Titel: " + ten.getTitle());
        }
        return allTEN;
    }

    /*--------------------------------------------------
        Methods to get one TEN object by ID
     --------------------------------------------------*/
    public static Todo getTodoByID(String id) {
        DatabaseRepository databaseRepository = new DatabaseRepository();
        Todo todo = databaseRepository.getTodoByID(id);
        return todo;
    }

    public static Event getEventByID(String id) {
        DatabaseRepository databaseRepository = new DatabaseRepository();
        Event event = databaseRepository.getEventByID(id);
        return event;
    }

    public static Note getNoteByID(String id) {
        DatabaseRepository databaseRepository = new DatabaseRepository();
        Note note = databaseRepository.getNoteByID(id);
        return note;
    }

    public static int[] getColors(String tenID) {
        DatabaseRepository databaseRepository = new DatabaseRepository();
        int[] colors = databaseRepository.getTENColors(tenID);
        return colors;
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=Update (Ruthild Gilles)]

public class Update {
    /* Ruthild Gilles
     Class Update contains methods to save information on a changed or newly created TEN.
    */

    /*--------------------------------------------------
        Methods for saving a TEN object
     --------------------------------------------------*/

    public static void saveTEN(TEN newTen) {
        DatabaseRepository databaseRepository = new DatabaseRepository();
        if (newTen.getID() == null) {
            databaseRepository.insertTEN(newTen);
        } else databaseRepository.updateTEN(newTen);
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=Delete (Ruthild Gilles)]

public class Delete {
    /* Ruthild Gilles
     Class Delete contains methods to delete the given TEN object.
    */

    public static void deleteTEN(String tenID) {
        DatabaseRepository databaseRepository = new DatabaseRepository();
        databaseRepository.deleteTEN(tenID);
    }

    public static void deleteMultipleTENs(ArrayList<String> tenIDs) {
        DatabaseRepository databaseRepository = new DatabaseRepository();
        for (String tenID : tenIDs) {
            databaseRepository.deleteTEN(tenID);
        }
    }
}
\end{lstlisting}
\end{figure}

\begin{figure}[H]
\begin{lstlisting}[caption=ImageService (Ruthild Gilles)]

public class ImageService {

    public static void saveImage(Image image) {
        try {
            FileRepository fileRepository = new FileRepository();
            fileRepository.saveImagePersistent(image);
        } catch (IOException e) {
            Log.e("ImageService", e.getMessage());
        }
    }

    public static Image getImage(Image image) {
        FileRepository fileRepository = new FileRepository();
        Image result = fileRepository.readImageFromDirectory(image, FileSystemConstants.IMAGE_ORIGINAL_FOLDER);
        return result;
    }

    public static Image getPreviewImage(Image image) {
        FileRepository fileRepository = new FileRepository();
        Image result = fileRepository.readImageFromDirectory(image, FileSystemConstants.IMAGE_PREVIEW_FOLDER);
        return result;
    }

    public static void deleteImage(Image image) {
        FileRepository fileRepository = new FileRepository();
        fileRepository.deleteImageFromDirectories(image);
    }

    public static void deleteImage(String path) {
        FileRepository fileRepository = new FileRepository();
        fileRepository.deleteImageFromDirectories(path);
    }

    public static File createImageFile(Activity pActivity) throws IOException {
        String timeStamp = new SimpleDateFormat("yyyyMMdd_HHmmss", Locale.GERMANY).format(new Date());
        String imageFileName = "JPEG_" + timeStamp + "_";
        File storageDir = pActivity.getExternalFilesDir(Environment.DIRECTORY_PICTURES);
        return File.createTempFile(imageFileName, ".jpg", storageDir);
    }
}
\end{lstlisting}
\end{figure}

\subsection{Modules}
	\subsubsection{Image Compression}
\lstinputlisting [caption=ImageCompressionModule (Jan Beilfuß)]{code/ImageCompressionModule.java}
\lstinputlisting [caption=ImageRotationCorrectionModule (Jan Beilfuß)]{code/ImageRotationCorrectionModule.java}
\lstinputlisting [caption=ImageToolsModule (Jan Beilfuß)]{code/ImageToolsModule.java}
	\subsubsection{Share}
\lstinputlisting [caption=ShareModule (Jan Beilfuß)]{code/ShareModule.java}


